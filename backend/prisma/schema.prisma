generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  name          String
  role          UserRole  @default(USER)
  status        UserStatus @default(ACTIVE)
  avatar        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?
  
  // Relations
  signals       Signal[]
  watchlists    Watchlist[]
  portfolio     Portfolio?
  journal       TradeJournal[]
  notifications Notification[]
  
  @@map("users")
}

model Signal {
  id              String      @id @default(uuid())
  symbol          String
  type            SignalType
  entryPrice      Decimal     @db.Decimal(20, 8)
  stopLoss        Decimal     @db.Decimal(20, 8)
  takeProfit      Decimal     @db.Decimal(20, 8)
  takeProfit2     Decimal?    @db.Decimal(20, 8)
  takeProfit3     Decimal?    @db.Decimal(20, 8)
  riskReward      String
  timeframe       String
  analysis        String      @db.Text
  status          SignalStatus @default(ACTIVE)
  result          SignalResult?
  closedPrice     Decimal?    @db.Decimal(20, 8)
  profitPips      Decimal?    @db.Decimal(20, 8)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  expiresAt       DateTime?
  
  // Relations
  authorId        String
  author          User        @relation(fields: [authorId], references: [id])
  likes           SignalLike[]
  
  @@index([status])
  @@index([symbol])
  @@index([createdAt])
  @@map("signals")
}

model SignalLike {
  id        String   @id @default(uuid())
  signalId  String
  userId    String
  createdAt DateTime @default(now())
  
  signal    Signal   @relation(fields: [signalId], references: [id], onDelete: Cascade)
  
  @@unique([signalId, userId])
  @@map("signal_likes")
}

model Watchlist {
  id        String   @id @default(uuid())
  userId    String
  symbols   String[]
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("watchlists")
}

model Portfolio {
  id            String   @id @default(uuid())
  userId        String   @unique
  balance       Decimal  @default(0) @db.Decimal(20, 8)
  equity        Decimal  @default(0) @db.Decimal(20, 8)
  margin        Decimal  @default(0) @db.Decimal(20, 8)
  freeMargin    Decimal  @default(0) @db.Decimal(20, 8)
  marginLevel   Decimal  @default(0) @db.Decimal(5, 2)
  totalProfit   Decimal  @default(0) @db.Decimal(20, 8)
  totalLoss     Decimal  @default(0) @db.Decimal(20, 8)
  winRate       Decimal  @default(0) @db.Decimal(5, 2)
  totalTrades   Int      @default(0)
  winningTrades Int      @default(0)
  losingTrades  Int      @default(0)
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("portfolios")
}

model TradeJournal {
  id          String    @id @default(uuid())
  userId      String
  symbol      String
  type        String
  entryDate   DateTime
  exitDate    DateTime?
  entryPrice  Decimal   @db.Decimal(20, 8)
  exitPrice   Decimal?  @db.Decimal(20, 8)
  lotSize     Decimal   @db.Decimal(10, 2)
  stopLoss    Decimal?  @db.Decimal(20, 8)
  takeProfit  Decimal?  @db.Decimal(20, 8)
  profitLoss  Decimal?  @db.Decimal(20, 8)
  pips        Decimal?  @db.Decimal(10, 2)
  status      String
  strategy    String?
  notes       String?   @db.Text
  emotions    String?
  lessons     String?   @db.Text
  screenshots String[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([status])
  @@map("trade_journals")
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  data      Json?
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())
  
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, read])
  @@map("notifications")
}

model MarketData {
  id        String   @id @default(uuid())
  symbol    String   @unique
  price     Decimal  @db.Decimal(20, 8)
  change24h Decimal  @db.Decimal(10, 2)
  volume24h Decimal  @db.Decimal(20, 2)
  high24h   Decimal  @db.Decimal(20, 8)
  low24h    Decimal  @db.Decimal(20, 8)
  updatedAt DateTime @updatedAt
  
  @@map("market_data")
}

model EconomicEvent {
  id          String   @id @default(uuid())
  date        DateTime
  time        String
  currency    String
  event       String
  impact      ImpactLevel
  actual      String?
  forecast    String?
  previous    String?
  createdAt   DateTime @default(now())
  
  @@index([date])
  @@index([currency])
  @@map("economic_events")
}

enum UserRole {
  USER
  ADMIN
  MODERATOR
  ANALYST
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
}

enum SignalType {
  BUY
  SELL
  BUY_LIMIT
  SELL_LIMIT
  BUY_STOP
  SELL_STOP
}

enum SignalStatus {
  ACTIVE
  CLOSED
  CANCELLED
  EXPIRED
}

enum SignalResult {
  WIN
  LOSS
  BREAKEVEN
  PENDING
}

enum NotificationType {
  SIGNAL
  PRICE_ALERT
  SYSTEM
  TRADE
  NEWS
}

enum ImpactLevel {
  LOW
  MEDIUM
  HIGH
}
